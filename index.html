<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>拼音表 · 发音 (Pinyin Table & Pronunciation)</title>
  <style>
:root{
  --bg:#fafbfd; --card:#fff; --accent:#1e88e5; --muted:#6b7280;
  font-family: "Noto Sans SC", "PingFang SC", "Helvetica Neue", Arial, sans-serif;
}
*{box-sizing:border-box}
body{margin:18px;background:var(--bg);color:#0f172a}
header h1{margin:0;font-size:1.4rem}
.muted{color:var(--muted);font-size:0.95rem;margin-top:6px}
main{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:14px;margin-top:12px}
.card{background:var(--card);padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(2,6,23,0.06)}
.grid{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
.chip{padding:8px 10px;border-radius:8px;border:1px solid #e6eef8;background:linear-gradient(180deg,#fff,#f3f9ff);cursor:pointer;min-width:56px;text-align:center}
.controls{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
.controls label{display:flex;gap:6px;align-items:center}
.controls select{padding:6px;border-radius:6px;border:1px solid #e6eef8}
button{background:var(--accent);color:#fff;border:none;padding:8px 10px;border-radius:6px;cursor:pointer}
.big{font-weight:700;font-size:1.2rem;margin-left:6px}
footer{margin-top:12px;text-align:center;color:var(--muted);font-size:0.9rem}
  </style>
</head>
<body>
  <header>
    <h1>拼音表 · 发音 (Pinyin Table & Pronunciation)</h1>
    <p class="muted">点击任意项播放发音，或在组合器中选择声母/韵母/声调生成拼音并播放。</p>
  </header>

  <main>
    <section class="card">
      <h2>声母（Initials / 声母）</h2>
      <div id="initials" class="grid"></div>
    </section>

    <section class="card">
      <h2>韵母（Finals / 韵母）</h2>
      <div id="finals" class="grid"></div>
    </section>

    <section class="card">
      <h2>拼音组合器（Generate & Play）</h2>
      <div class="controls">
        <label>声母：
          <select id="sel-initial"></select>
        </label>
        <label>韵母：
          <select id="sel-final"></select>
        </label>
        <label>声调：
          <select id="sel-tone">
            <option value="1">1（阴平）</option>
            <option value="2">2（阳平）</option>
            <option value="3">3（上声）</option>
            <option value="4">4（去声）</option>
            <option value="0">0（轻声 / neutral）</option>
          </select>
        </label>
        <button id="gen-play">生成并播放</button>
      </div>
      <p>结果：<span id="result" class="big"></span></p>
      <p class="muted">说明：音标上的声调使用标准拼音音调符号（ā á ǎ à），发音由浏览器 SpeechSynthesis 生成。</p>
    </section>

    <section class="card">
      <h2>示例常用音节（Common syllables）</h2>
      <div id="presets" class="grid"></div>
    </section>
  </main>

  <footer>
    <p class="muted">示例项目 · 如需将发音替换为真实录音（更准确），我可以帮你生成或接入音频资源。</p>
  </footer>

  <script>
/* ====== script.js 内容（已内联） ====== */
// 拼音声母与韵母（基础集合，常见教学用）
const INITIALS = ["", "b","p","m","f","d","t","n","l","g","k","h","j","q","x","zh","ch","sh","r","z","c","s","y","w"];
const FINALS = [
  "a","o","e","ai","ei","ao","ou","an","en","ang","eng","ong",
  "i","ia","iao","ie","iu","ian","in","iang","ing","iong",
  "u","ua","uo","uai","ui","uan","un","uang",
  "ü","üe","üan","ün"
];

// 一些常用音节预设（方便用户快速试听）
const PRESETS = [
  "ma1","ma2","ma3","ma4",
  "ba1","bo1",
  "zhong1","guo2","ren2",
  "ni3","hao3","xie4",
  "ai4","ou1","ang1","eng1"
];

// DOM
const initialsEl = document.getElementById('initials');
const finalsEl = document.getElementById('finals');
const selInitial = document.getElementById('sel-initial');
const selFinal = document.getElementById('sel-final');
const selTone = document.getElementById('sel-tone');
const genPlayBtn = document.getElementById('gen-play');
const resultEl = document.getElementById('result');
const presetsEl = document.getElementById('presets');

// 帮助函数：将不带声调的拼音（如 "bao"）和声调数字 (1-4, 0=轻声) 转为带调字符（如 "bǎo"）
const TONE_MARKS = {
  a: ['ā','á','ǎ','à'],
  o: ['ō','ó','ǒ','ò'],
  e: ['ē','é','ě','è'],
  i: ['ī','í','ǐ','ì'],
  u: ['ū','ú','ǔ','ù'],
  ü: ['ǖ','ǘ','ǚ','ǜ']
};

// 根据拼音拼写规则，确定要加音调符号的元音顺序：a > o > e > (i/u/ü按次序)
function applyToneMark(syllable, tone){
  if(tone === 0) return syllable; // 轻声保持不变
  // 标准化：把 v 或 u: 视为 ü
  let s = syllable.replace(/v/g, 'ü').replace(/u:/g, 'ü');
  // 优先找到 a, o, e
  const vowels = ['a','o','e','i','u','ü'];
  let targetIndex = -1;
  // special rule: "iu" and "ui" tone mark on second vowel
  if(/iu/.test(s)) targetIndex = s.indexOf('u');
  if(/ui/.test(s)) targetIndex = s.indexOf('i');
  if(targetIndex === -1){
    for(const v of ['a','o','e']){
      const idx = s.indexOf(v);
      if(idx !== -1){ targetIndex = idx; break; }
    }
  }
  if(targetIndex === -1){
    // find first i/u/ü
    for(const v of ['i','u','ü']){
      const idx = s.indexOf(v);
      if(idx !== -1){ targetIndex = idx; break; }
    }
  }
  if(targetIndex === -1) return s; // 没有元音？
  const ch = s[targetIndex];
  const marks = TONE_MARKS[ch];
  if(!marks) return s;
  const marked = marks[tone-1];
  return s.slice(0,targetIndex) + marked + s.slice(targetIndex+1);
}

// 构造并播放拼音（输入：无声调 pinyinBase 如 "bao"，tone 0-4）
function playPinyin(pinyinBase, tone){
  const textWithMark = applyToneMark(pinyinBase, tone);
  resultEl.textContent = textWithMark;
  speak(textWithMark);
}

// 简单的 TTS：使用浏览器 SpeechSynthesis 朗读传入的文本
function speak(text){
  if(!('speechSynthesis' in window)){
    alert('当前浏览器不支持 SpeechSynthesis（语音合成）。');
    return;
  }
  const utter = new SpeechSynthesisUtterance(text);
  // 尽量使用中文发音以获得更接近的普通话音色（效果依赖浏览器实现）
  utter.lang = 'zh-CN';
  // 一些浏览器不识别拼音；若设备支持，朗读汉字会更准确。
  // 这里直接朗读拼音字符串，作为教学演示。如果你有汉字音频或文字示例，可替换为汉字播放。
  window.speechSynthesis.cancel();
  window.speechSynthesis.speak(utter);
}

// 渲染声母按钮
function renderInitials(){
  INITIALS.forEach(i => {
    const el = document.createElement('div');
    el.className = 'chip';
    el.textContent = i === '' ? '（空）' : i;
    el.title = i === '' ? '无声母（以韵母发音）' : i;
    el.addEventListener('click', () => {
      // 播放一个常见示例：声母 + 'a'，并用第一声演示
      const base = (i === '' ? 'a' : i + 'a');
      playPinyin(base, 1);
    });
    initialsEl.appendChild(el);

    // populate selector
    const opt = document.createElement('option');
    opt.value = i;
    opt.textContent = i === '' ? '(空)' : i;
    selInitial.appendChild(opt);
  });
}

// 渲染韵母按钮
function renderFinals(){
  FINALS.forEach(f => {
    const el = document.createElement('div');
    el.className = 'chip';
    el.textContent = f;
    el.title = f;
    el.addEventListener('click', () => {
      // 播放韵母本身（加上常用声母空或 y/w），用第一声演示
      // 若韵母以 i/u/ü 开头，常与 y/w 结合来发音（教学上常用）
      const prefix = /^[iuü]/.test(f) ? '' : ''; // 这里只直接播放韵母
      playPinyin(f, 1);
    });
    finalsEl.appendChild(el);

    // populate selector
    const opt = document.createElement('option');
    opt.value = f;
    opt.textContent = f;
    selFinal.appendChild(opt);
  });
}

// 预设常用音节快速试听
function renderPresets(){
  PRESETS.forEach(p => {
    const el = document.createElement('div');
    el.className = 'chip';
    el.textContent = p;
    el.addEventListener('click', () => {
      // 拆分数字声调尾部
      const m = p.match(/^([a-zü]+)([1-5])?$/i);
      const base = m ? m[1] : p;
      const tone = m && m[2] ? Number(m[2]) : 1;
      playPinyin(base, tone === 5 ? 0 : tone);
    });
    presetsEl.appendChild(el);
  });
}

// 组合器按钮事件
genPlayBtn.addEventListener('click', () => {
  const ini = selInitial.value; // 可能为空字符串
  const fin = selFinal.value;
  let base = (ini || '') + (fin || '');
  // 处理拼写习惯：当初学者把 "ü" 写成 "v"，但下拉里已经是 "ü"
  base = base.replace(/v/g, 'ü');
  const tone = Number(selTone.value);
  playPinyin(base, tone);
});

// 初始化
renderInitials();
renderFinals();
renderPresets();

// 默认选择
selInitial.value = "";
selFinal.value = "a";
selTone.value = "1";
resultEl.textContent = applyToneMark("a",1);
  </script>
</body>
</html>
